import React, { useState, useEffect } from "react";
import {
  NavBar,
  NavLinkIcons,
  NavLinkIconsContainerLeft,
  NavLinkSVG,
  UPContainer,
  UPBtn,
  UPSVG,
} from "../Styles/ChatDir.styles";
import { useHistory } from "react-router-dom";
import CreateGroup from "./CreateGroup.component";
import SearchBar from "./SearchBar.component";
const ChatDirNav = ({
  deleteChat,
  setDeleteChat,
  setSelectedChats,
  user,
  fetchChats,
  selectedChats,
  setUser,
}) => {
  const [isCreate, setIsCreate] = useState(false);
  const [isProfileHovered, setIsProfileHovered] = useState(false);
  const [isProfileLinkHovered, setIsProfileLinkHovered] = useState("");
  const history = useHistory();
  const onDeleteMessage = (chat) => {
    if (selectedChats.length > 0) {
      fetch("http://localhost:5005/delete/whole", {
        method: "DELETE",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({
          chatrooms: selectedChats,
          username: user.username,
        }),
      })
        .then((response) => response.json())
        .then((data) => {
          fetchChats();
          setSelectedChats([]);
          setDeleteChat(false);
        });
    }
  };
  return (
    <NavBar>
      <NavLinkIconsContainerLeft>
        <NavLinkIcons onClick={() => history.push("/map")}>
          <NavLinkSVG
            version="1.1"
            id="Layer_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            x="0px"
            y="0px"
            viewBox="0 0 512 512"
            style={{ enableBackground: "new 0 0 512 512" }}
            xmlSpace="preserve"
          >
            <title>Map</title>
            <g>
              <g>
                <path
                  d="M256,0C153.755,0,70.573,83.182,70.573,185.426c0,126.888,165.939,313.167,173.004,321.035
			c6.636,7.391,18.222,7.378,24.846,0c7.065-7.868,173.004-194.147,173.004-321.035C441.425,83.182,358.244,0,256,0z M256,278.719
			c-51.442,0-93.292-41.851-93.292-93.293S204.559,92.134,256,92.134s93.291,41.851,93.291,93.293S307.441,278.719,256,278.719z"
                />
              </g>
            </g>
          </NavLinkSVG>
        </NavLinkIcons>

        <NavLinkIcons
          onClick={() => {
            setDeleteChat(!deleteChat);
            setSelectedChats([]);
          }}
        >
          {!deleteChat ? (
            <NavLinkSVG
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlnsXlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              viewBox="0 0 332.003 332.003"
              style={{ enableBackground: "new 0 0 332.003 332.003" }}
              xmlSpace="preserve"
            >
              <title>Delete Chat</title>
              <g>
                <g>
                  <path
                    d="M273.93,8.29h-75.561C196.64,3.461,192.035,0,186.61,0h-41.218c-5.424,0-10.027,3.461-11.758,8.29H58.073
			c-19.063,0-34.572,15.509-34.572,34.571v31.448c0,6.903,5.597,12.5,12.5,12.5H59.51v232.694c0,6.903,5.597,12.5,12.5,12.5h187.982
			c6.902,0,12.5-5.597,12.5-12.5V86.81h23.51c6.903,0,12.5-5.597,12.5-12.5V42.862C308.502,23.799,292.993,8.29,273.93,8.29z
			 M247.493,307.004H84.511V86.81h162.982V307.004z M283.502,61.81h-235V42.862c0-5.277,4.293-9.571,9.572-9.571h215.855
			c5.277,0,9.572,4.294,9.572,9.571L283.502,61.81L283.502,61.81z"
                  />
                  <path
                    d="M133.245,263.873c6.903,0,12.5-5.598,12.5-12.5V119.638c0-6.903-5.597-12.5-12.5-12.5c-6.903,0-12.5,5.597-12.5,12.5
			v131.735C120.745,258.275,126.342,263.873,133.245,263.873z"
                  />
                  <path
                    d="M198.759,263.873c6.903,0,12.5-5.598,12.5-12.5V119.638c0-6.903-5.597-12.5-12.5-12.5c-6.902,0-12.5,5.597-12.5,12.5
			v131.735C186.259,258.275,191.856,263.873,198.759,263.873z"
                  />
                </g>
              </g>
            </NavLinkSVG>
          ) : (
            <svg
              version="1.1"
              id="Capa_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlnsXlink="http://www.w3.org/1999/xlink"
              x="0px"
              y="0px"
              viewBox="0 0 512 512"
              style={{ enableBackground: "new 0 0 512 512" }}
              xmlSpace="preserve"
            >
              <g>
                <g>
                  <path
                    d="M256,0C114.508,0,0,114.497,0,256c0,141.493,114.497,256,256,256c141.492,0,256-114.497,256-256
			C512,114.507,397.503,0,256,0z M256,472c-119.384,0-216-96.607-216-216c0-119.385,96.607-216,216-216
			c119.384,0,216,96.607,216,216C472,375.385,375.393,472,256,472z"
                  />
                </g>
              </g>
              <g>
                <g>
                  <path
                    d="M343.586,315.302L284.284,256l59.302-59.302c7.81-7.81,7.811-20.473,0.001-28.284c-7.812-7.811-20.475-7.81-28.284,0
			L256,227.716l-59.303-59.302c-7.809-7.811-20.474-7.811-28.284,0c-7.81,7.811-7.81,20.474,0.001,28.284L227.716,256
			l-59.302,59.302c-7.811,7.811-7.812,20.474-0.001,28.284c7.813,7.812,20.476,7.809,28.284,0L256,284.284l59.303,59.302
			c7.808,7.81,20.473,7.811,28.284,0C351.398,335.775,351.397,323.112,343.586,315.302z"
                  />
                </g>
              </g>
            </svg>
          )}
        </NavLinkIcons>
        <NavLinkIcons onClick={() => setIsCreate(!isCreate)}>
          <NavLinkSVG
            viewBox="0 0 511.99981 511"
            xmlns="http://www.w3.org/2000/svg"
          >
            <title>Create Group</title>
            <path d="m296.464844 336.097656c-12.519532-8.734375-25.898438-15.851562-39.890625-21.289062 18.613281-16.917969 30.960937-40.617188 33.109375-67.148438 28.226562-27.503906 65.226562-42.582031 104.890625-42.582031 30.964843 0 60.695312 9.324219 85.984375 26.960937 9.0625 6.320313 21.523437 4.101563 27.84375-4.960937 6.316406-9.058594 4.097656-21.523437-4.960938-27.839844-12.519531-8.734375-25.902344-15.847656-39.894531-21.289062 20.539063-18.667969 33.453125-45.585938 33.453125-75.460938 0-56.238281-45.75-101.988281-101.988281-101.988281-56.234375 0-101.984375 45.75-101.984375 101.988281 0 29.753907 12.808594 56.574219 33.207031 75.234375-2.792969 1.074219-5.570313 2.210938-8.320313 3.421875-12.515624 5.507813-24.28125 12.28125-35.222656 20.234375-15.089844-37.488281-51.828125-64.019531-94.652344-64.019531-56.234374 0-101.988281 45.75-101.988281 101.984375 0 29.671875 12.738281 56.417969 33.027344 75.070312-54.246094 20.324219-98.230469 63.976563-116.136719 119.648438-5.9375 18.460938-2.792968 38.039062 8.628906 53.714844 11.421876 15.671875 29.09375 24.660156 48.484376 24.660156h173.980468c11.042969 0 19.996094-8.953125 19.996094-20 0-11.042969-8.953125-19.996094-19.996094-19.996094h-173.980468c-6.464844 0-12.355469-2.996094-16.164063-8.222656s-4.855469-11.753906-2.878906-17.910156c19.765625-61.453125 80.046875-104.371094 146.589843-104.371094 30.960938 0 60.695313 9.324219 85.984376 26.960938 9.058593 6.320312 21.523437 4.097656 27.84375-4.960938 6.316406-9.058594 4.097656-21.523438-4.964844-27.839844zm98.546875-295.601562c34.183593 0 61.992187 27.808594 61.992187 61.992187 0 34.179688-27.808594 61.992188-61.992187 61.992188-34.179688 0-61.992188-27.8125-61.992188-61.992188 0-34.183593 27.8125-61.992187 61.992188-61.992187zm-206.972657 136.855468c34.183594 0 61.992188 27.8125 61.992188 61.992188 0 34.183594-27.808594 61.992188-61.992188 61.992188-34.183593 0-61.992187-27.808594-61.992187-61.992188 0-34.179688 27.808594-61.992188 61.992187-61.992188zm323.960938 240.097657c0 11.042969-8.953125 19.996093-20 19.996093h-54.992188v54.992188c0 11.046875-8.953124 20-19.996093 20-11.046875 0-20-8.953125-20-20v-54.992188h-54.992188c-11.042969 0-19.996093-8.953124-19.996093-19.996093 0-11.046875 8.953124-20 19.996093-20h54.992188v-54.992188c0-11.042969 8.953125-19.996093 20-19.996093 11.042969 0 19.996093 8.953124 19.996093 19.996093v54.992188h54.992188c11.046875 0 20 8.953125 20 20zm0 0" />
          </NavLinkSVG>
        </NavLinkIcons>

        <NavLinkIcons
          onClick={onDeleteMessage}
          disabled={!deleteChat ? true : false}
          style={{
            opacity: !deleteChat ? "0" : "100%",
            transition: "all .3s ease-out",
            cursor: deleteChat ? "pointer" : "default",
          }}
        >
          <NavLinkSVG
            version="1.1"
            id="Capa_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            x="0px"
            y="0px"
            viewBox="0 0 332.003 332.003"
            style={{ enableBackground: "new 0 0 332.003 332.003" }}
            xmlSpace="preserve"
          >
            <title>Delete</title>
            <g>
              <g>
                <path
                  d="M273.93,8.29h-75.561C196.64,3.461,192.035,0,186.61,0h-41.218c-5.424,0-10.027,3.461-11.758,8.29H58.073
			c-19.063,0-34.572,15.509-34.572,34.571v31.448c0,6.903,5.597,12.5,12.5,12.5H59.51v232.694c0,6.903,5.597,12.5,12.5,12.5h187.982
			c6.902,0,12.5-5.597,12.5-12.5V86.81h23.51c6.903,0,12.5-5.597,12.5-12.5V42.862C308.502,23.799,292.993,8.29,273.93,8.29z
			 M247.493,307.004H84.511V86.81h162.982V307.004z M283.502,61.81h-235V42.862c0-5.277,4.293-9.571,9.572-9.571h215.855
			c5.277,0,9.572,4.294,9.572,9.571L283.502,61.81L283.502,61.81z"
                />
                <path
                  d="M133.245,263.873c6.903,0,12.5-5.598,12.5-12.5V119.638c0-6.903-5.597-12.5-12.5-12.5c-6.903,0-12.5,5.597-12.5,12.5
			v131.735C120.745,258.275,126.342,263.873,133.245,263.873z"
                />
                <path
                  d="M198.759,263.873c6.903,0,12.5-5.598,12.5-12.5V119.638c0-6.903-5.597-12.5-12.5-12.5c-6.902,0-12.5,5.597-12.5,12.5
			v131.735C186.259,258.275,191.856,263.873,198.759,263.873z"
                />
              </g>
            </g>
          </NavLinkSVG>
        </NavLinkIcons>
      </NavLinkIconsContainerLeft>
      {isCreate ? (
        <CreateGroup
          setIsCreate={setIsCreate}
          isCreate={isCreate}
          user={user}
        />
      ) : null}
      <SearchBar user={user} />
      <NavLinkIcons
        onClick={() => setIsProfileHovered(!isProfileHovered)}
        isProfile={true}
        isProfileHovered={isProfileHovered}
      >
        <NavLinkSVG
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          id="light"
          enable-background="new 0 0 24 24"
        >
          <title>More</title>

          <g>
            <path d="m21.5 24h-19c-1.379 0-2.5-1.122-2.5-2.5v-19c0-1.378 1.121-2.5 2.5-2.5h19c1.379 0 2.5 1.122 2.5 2.5v19c0 1.378-1.121 2.5-2.5 2.5zm-19-23c-.827 0-1.5.673-1.5 1.5v19c0 .827.673 1.5 1.5 1.5h19c.827 0 1.5-.673 1.5-1.5v-19c0-.827-.673-1.5-1.5-1.5z"></path>
          </g>
          <g>
            <path d="m16.5 8h-9c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h9c.276 0 .5.224.5.5s-.224.5-.5.5z"></path>
          </g>
          <g>
            <path d="m16.5 12.5h-9c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h9c.276 0 .5.224.5.5s-.224.5-.5.5z"></path>
          </g>
          <g>
            <path d="m16.5 17h-9c-.276 0-.5-.224-.5-.5s.224-.5.5-.5h9c.276 0 .5.224.5.5s-.224.5-.5.5z"></path>
          </g>
        </NavLinkSVG>
      </NavLinkIcons>

      <UPContainer className="" isProfileHovered={isProfileHovered}>
        <UPBtn
          onClick={() => setUser({})}
          first={true}
          onMouseEnter={() => setIsProfileLinkHovered("Logout")}
          onMouseLeave={() => setIsProfileLinkHovered("")}
        >
          <UPSVG
            height="512pt"
            viewBox="0 0 511 512"
            width="512pt"
            xmlns="http://www.w3.org/2000/svg"
            isProfileLinkHovered={isProfileLinkHovered}
            svg="Logout"
          >
            <path d="m361.5 392v40c0 44.113281-35.886719 80-80 80h-201c-44.113281 0-80-35.886719-80-80v-352c0-44.113281 35.886719-80 80-80h201c44.113281 0 80 35.886719 80 80v40c0 11.046875-8.953125 20-20 20s-20-8.953125-20-20v-40c0-22.054688-17.945312-40-40-40h-201c-22.054688 0-40 17.945312-40 40v352c0 22.054688 17.945312 40 40 40h201c22.054688 0 40-17.945312 40-40v-40c0-11.046875 8.953125-20 20-20s20 8.953125 20 20zm136.355469-170.355469-44.785157-44.785156c-7.8125-7.8125-20.476562-7.8125-28.285156 0-7.8125 7.808594-7.8125 20.472656 0 28.28125l31.855469 31.859375h-240.140625c-11.046875 0-20 8.953125-20 20s8.953125 20 20 20h240.140625l-31.855469 31.859375c-7.8125 7.808594-7.8125 20.472656 0 28.28125 3.90625 3.90625 9.023438 5.859375 14.140625 5.859375 5.121094 0 10.238281-1.953125 14.144531-5.859375l44.785157-44.785156c19.496093-19.496094 19.496093-51.214844 0-70.710938zm0 0" />
          </UPSVG>
          Log Out
        </UPBtn>
        <UPBtn
          onClick={() => history.push(`/${user.username}/profile`)}
          onMouseEnter={() => setIsProfileLinkHovered("profile")}
          onMouseLeave={() => setIsProfileLinkHovered("")}
        >
          <UPSVG
            isProfileLinkHovered={isProfileLinkHovered}
            version="1.1"
            id="Capa_1"
            xmlns="http://www.w3.org/2000/svg"
            xmlnsXlink="http://www.w3.org/1999/xlink"
            x="0px"
            y="0px"
            viewBox="0 0 512 512"
            style={{ enableBackground: "new 0 0 512 512" }}
            xmlSpace="preserve"
            svg="profile"
          >
            <path d="M0,435.2V512h512v-76.8C512,263.68,0,263.68,0,435.2z" />

            <circle cx={256} cy={128} r={128} />
          </UPSVG>
          {user.username}
        </UPBtn>
        <UPBtn
          onClick={() => history.push("/forget/password")}
          onMouseEnter={() => setIsProfileLinkHovered("forgot")}
          onMouseLeave={() => setIsProfileLinkHovered("")}
        >
          <UPSVG
            x="0px"
            y="0px"
            viewBox="0 0 512 512"
            svg="forgot"
            isProfileLinkHovered={isProfileLinkHovered}
          >
            <g>
              <g>
                <g>
                  <circle cx="277.937" cy="346" r="20" />
                  <path
                    d="M344.937,471.999h-249c-22.056,0-40-17.944-40-40v-164c0-22.056,17.944-40,40-40h288c4.554,0,8.167,0.402,11.047,1.227
				c10.618,3.042,21.692-3.1,24.735-13.718c3.042-10.618-3.1-21.692-13.718-24.735c-6.513-1.866-13.73-2.773-22.064-2.773H359.9
				v-70.534C359.9,52.695,306.068,0,239.9,0s-120,52.695-120,117.466V188H95.937c-44.112,0-80,35.888-80,80v164
				c0,44.112,35.888,80,80,80h249c11.046,0,20-8.954,20-20C364.937,480.954,355.983,472,344.937,471.999z M159.9,117.466
				c0-42.715,35.888-77.466,80-77.466s80,34.751,80,77.466V188h-160V117.466z"
                  />
                  <circle cx="202.937" cy="346" r="20" />
                  <path
                    d="M496.046,331.21c-0.438-38.789-32.13-70.21-71.021-70.21C385.863,261,354,292.862,354,332.025c0,11.046,8.954,20,20,20
				c11.046,0,20-8.954,20-20C394,314.918,407.918,301,425.026,301c17.108,0,31.025,13.918,31.025,31.025
				c0,0.182,0.002,0.363,0.007,0.543c-0.206,12.247-7.563,23.211-18.864,28.035c-19.541,8.345-32.168,27.618-32.168,49.101V427
				c0,11.046,8.954,20,20,20c11.046,0,20-8.954,20-20v-17.296c0-5.438,3.092-10.271,7.875-12.313
				c26.227-11.196,43.169-36.855,43.162-65.37C496.063,331.749,496.057,331.479,496.046,331.21z"
                  />
                  <circle cx="424.937" cy="492" r="20" />
                  <circle cx="127.937" cy="346" r="20" />
                </g>
              </g>
            </g>
          </UPSVG>
          Forgot Password
        </UPBtn>
      </UPContainer>
    </NavBar>
  );
};

export default ChatDirNav;
